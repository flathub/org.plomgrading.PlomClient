# SPDX-License-Identifier: FSFAP
# Copyright (C) 2020-2022 Colin B. Macdonald
#
# Copying and distribution of this file, with or without modification,
# are permitted in any medium without royalty provided the copyright
# notice and this notice are preserved.  This file is offered as-is,
# without any warranty.

# TODO: drop toml and packaging if they come from the PyQy.BaseApp

app-id: org.plomgrading.PlomClient
runtime: org.kde.Platform
runtime-version: 5.15-21.08
sdk: org.kde.Sdk
command: PlomClient
finish-args:
  - --socket=wayland
  - --socket=x11
  - --share=ipc
  - --device=dri
  - --share=network
base: com.riverbankcomputing.PyQt.BaseApp
base-version: 5.15-21.08
cleanup-commands:
  - /app/cleanup-BaseApp.sh
build-options:
  env:
    - BASEAPP_REMOVE_WEBENGINE=1
modules:
  - python3-appdirs.json
  - python3-exif.json
  - python3-stdiomask.json
  - python3-requests-toolbelt.json
  - python3-arrow.json
  # python3-Pillow.json, unnecessary as a dep of weasyprint
  - python3-pymupdf.yaml
  - python3-segno.json
  - python3-tqdm.json
  - python3-weasyprint.json

  - name: Plom
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=$FLATPAK_DEST --no-deps --no-build-isolation .
      - install -D PlomClient.workaround $FLATPAK_DEST/bin/PlomClient
    sources:
      - type: archive
        url: https://pypi.io/packages/source/p/plom/plom-0.10.0.tar.gz
        sha256: 18f20ffeaf972403e6d2a85a0a456aaae91d154b3df3e39a6b88cdfab8e229be
        x-checker-data:
          type: anitya
          project-id: 92380
          stable-only: true
          url-template: https://pypi.io/packages/source/p/plom/plom-$version.tar.gz
      - type: file
        path: PlomClient.workaround
